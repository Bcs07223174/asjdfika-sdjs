<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Diagnostics - ClinicCare</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-8">Database Diagnostics</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Database Test -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Database Connection Test</h2>
                <button id="testDb" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test Database Connection
                </button>
                <div id="dbResult" class="mt-4 p-3 rounded bg-gray-50 hidden"></div>
            </div>

            <!-- Doctors API Test -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Doctors API Test</h2>
                <button id="testDoctors" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Fetch Doctors
                </button>
                <div id="doctorsResult" class="mt-4 p-3 rounded bg-gray-50 hidden"></div>
            </div>

            <!-- Simple Seed Test -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Simple Seed Test</h2>
                <button id="simpleSeed" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    Insert Test Doctor
                </button>
                <div id="seedResult" class="mt-4 p-3 rounded bg-gray-50 hidden"></div>
            </div>

            <!-- Appointments Test -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold mb-4">Appointments Test</h2>
                <input type="text" id="patientId" placeholder="Patient ID" class="border rounded px-3 py-2 w-full mb-2" value="68c1c32434a01f54baf918fe">
                <button id="testAppointments" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    Fetch Appointments
                </button>
                <div id="appointmentsResult" class="mt-4 p-3 rounded bg-gray-50 hidden"></div>
            </div>

            <!-- Schedule Test -->
            <div class="bg-white rounded-lg shadow-md p-6 md:col-span-2">
                <h2 class="text-xl font-semibold mb-4">Schedule Test</h2>
                <input type="text" id="doctorId" placeholder="Doctor ID" class="border rounded px-3 py-2 w-1/2 mb-2 mr-2">
                <input type="date" id="scheduleDate" class="border rounded px-3 py-2 w-1/3 mb-2">
                <button id="testSchedule" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    Fetch Schedule
                </button>
                <div id="scheduleResult" class="mt-4 p-3 rounded bg-gray-50 hidden"></div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to display results
        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.classList.remove('hidden');
            element.className = `mt-4 p-3 rounded ${isError ? 'bg-red-100 border border-red-300' : 'bg-green-100 border border-green-300'}`;
            element.innerHTML = `<pre class="text-sm overflow-x-auto">${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Test Database Connection
        document.getElementById('testDb').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/test-db');
                const data = await response.json();
                showResult('dbResult', data, !response.ok);
            } catch (error) {
                showResult('dbResult', { error: error.message }, true);
            }
        });

        // Test Doctors API
        document.getElementById('testDoctors').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/doctors');
                const data = await response.json();
                showResult('doctorsResult', data, !response.ok);
            } catch (error) {
                showResult('doctorsResult', { error: error.message }, true);
            }
        });

        // Simple Seed Test
        document.getElementById('simpleSeed').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/seed-simple', { method: 'POST' });
                const data = await response.json();
                showResult('seedResult', data, !response.ok);
            } catch (error) {
                showResult('seedResult', { error: error.message }, true);
            }
        });

        // Test Appointments
        document.getElementById('testAppointments').addEventListener('click', async () => {
            try {
                const patientId = document.getElementById('patientId').value;
                const response = await fetch(`/api/appointments?patientId=${patientId}`);
                const data = await response.json();
                showResult('appointmentsResult', data, !response.ok);
            } catch (error) {
                showResult('appointmentsResult', { error: error.message }, true);
            }
        });

        // Test Schedule
        document.getElementById('testSchedule').addEventListener('click', async () => {
            try {
                const doctorId = document.getElementById('doctorId').value;
                const date = document.getElementById('scheduleDate').value;
                const response = await fetch(`/api/schedule/${doctorId}?date=${date}`);
                const data = await response.json();
                showResult('scheduleResult', data, !response.ok);
            } catch (error) {
                showResult('scheduleResult', { error: error.message }, true);
            }
        });

        // Set default date to today
        document.getElementById('scheduleDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
